#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_TRAINS 5
#define MAX_SEATS  50
#define MAX_NAME   100

// Structure for train details
typedef struct {
    int train_no;
    char name[50];
    char source[30];
    char destination[30];
    int seats_available;
} Train;

// Structure for passenger booking
typedef struct {
    char passenger_name[MAX_NAME];
    int age;
    int train_no;
    int seat_no;
} Booking;

// Global arrays
Train trains[MAX_TRAINS];
Booking bookings[MAX_SEATS * MAX_TRAINS];
int booking_count = 0;

// Function prototypes
void initialize_trains();
void show_trains();
void book_ticket();
void view_bookings();

int main() {
    int choice;

    initialize_trains();

    while (1) {
        printf("\n====== Train Ticket Booking System ======\n");
        printf("1. View Available Trains\n");
        printf("2. Book Ticket\n");
        printf("3. View Bookings\n");
        printf("4. Exit\n");
        printf("Enter choice: ");
        scanf("%d", &choice);

        switch (choice) {
            case 1:
                show_trains();
                break;
            case 2:
                book_ticket();
                break;
            case 3:
                view_bookings();
                break;
            case 4:
                printf("Exiting... Thank you!\n");
                exit(0);
            default:
                printf("Invalid choice. Try again.\n");
        }
    }
    return 0;
}

void initialize_trains() {
    trains[0] = (Train){22616, "Mangalore Express", "Delhi", "Mangalore", MAX_SEATS};
    trains[1] = (Train){22222, "Uday Express", "Bangalore", "Coimbatore", MAX_SEATS};
    trains[2] = (Train){17229, "Sabari Express", "Trivandrum", "Hydrebad", MAX_SEATS};
    trains[3] = (Train){22154, "Chennai Express", "Chennai", "Salem", MAX_SEATS};
    trains[4] = (Train){14526, "TamilNadu Express", "Chennai", "Delhi", MAX_SEATS};
}

void show_trains() {
    printf("\n%-10s %-20s %-15s %-15s %-10s\n", 
           "Train No", "Train Name", "Source", "Destination", "Seats");
    printf("-----------------------------------------------------------------\n");
    for (int i = 0; i < MAX_TRAINS; i++) {
        printf("%-10d %-20s %-15s %-15s %-10d\n", 
               trains[i].train_no, trains[i].name, trains[i].source,
               trains[i].destination, trains[i].seats_available);
    }
}

void book_ticket() {
    int train_no;
    char name[MAX_NAME];
    int age;

    show_trains();
    printf("\nEnter Train Number to book: ");
    scanf("%d", &train_no);

    // Find train
    int index = -1;
    for (int i = 0; i < MAX_TRAINS; i++) {
        if (trains[i].train_no == train_no) {
            index = i;
            break;
        }
    }

    if (index == -1) {
        printf("Invalid Train Number!\n");
        return;
    }

    if (trains[index].seats_available <= 0) {
        printf("No seats available on this train.\n");
        return;
    }

    printf("Enter Passenger Name: ");
    scanf(" %[^\n]", name);
    printf("Enter Age: ");
    scanf("%d", &age);

    Booking b;
    strcpy(b.passenger_name, name);
    b.age = age;
    b.train_no = train_no;
    b.seat_no = MAX_SEATS - trains[index].seats_available + 1;

    // Save booking
    bookings[booking_count++] = b;
    trains[index].seats_available--;

    printf("Ticket booked successfully!\n");
    printf("Passenger: %s | Age: %d | Train: %s | Seat No: %d\n",
           b.passenger_name, b.age, trains[index].name, b.seat_no);
}

void view_bookings() {
    if (booking_count == 0) {
        printf("\nNo bookings yet.\n");
        return;
    }

    printf("\n%-20s %-5s %-10s %-10s\n", 
           "Passenger Name", "Age", "Train No", "Seat No");
    printf("-----------------------------------------------\n");

    for (int i = 0; i < booking_count; i++) {
        printf("%-20s %-5d %-10d %-10d\n",
               bookings[i].passenger_name,
               bookings[i].age,
               bookings[i].train_no,
               bookings[i].seat_no);
    }
}
